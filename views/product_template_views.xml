<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <record id="product_template_form_view_custom_prices" model="ir.ui.view">
        <field name="name">product.template.form.custom.prices</field>
        <field name="model">product.template</field>
        <field name="inherit_id" ref="product.product_template_only_form_view"/>
        <field name="arch" type="xml">
            <xpath expr="//field[@name='categ_id']" position="before">
                <field name="x_name_sps"/>
            </xpath>
                        
            <xpath expr="//page[@name='sales']" position="after">
                <page string="Precios y Costos All-In" name="custom_prices" 
                      groups="inventory_shopping_cart.group_price_authorizer,inventory_shopping_cart.group_seller">
                    
                    <!-- PANEL DE CONFIGURACIÓN LOGÍSTICA -->
                    <group string="Configuración Logística y Arancelaria">
                        <group>
                            <field name="x_origin_country_id"/>
                            <field name="x_pol_id" options="{'no_create': True}"/>
                            <field name="x_pod_id" options="{'no_create': True}"/>
                        </group>
                        <group>
                            <field name="x_container_capacity"/>
                            <field name="x_arancel_pct"/>
                            <button name="action_update_costs" string="Recalcular Costos Ahora" type="object" class="btn-link" icon="fa-refresh"/>
                        </group>
                    </group>

                    <!-- DESGLOSE DE COSTOS -->
                    <group>
                        <group string="Desglose del Costo (MXN)" groups="inventory_shopping_cart.group_price_authorizer">
                            <field name="x_has_purchases" invisible="1"/>
                            
                            <label for="x_max_avg_cost_mxn" string="1. Costo Base"/>
                            <div class="o_row">
                                <field name="x_max_avg_cost_mxn"/>
                                <span class="text-muted" invisible="x_has_purchases">(Costo Estándar)</span>
                                <span class="text-success fw-bold" invisible="not x_has_purchases">(MaxAvg Histórico)</span>
                            </div>
                            
                            <field name="x_logistics_cost_mxn" string="2. + Logística (x m²)"/>
                            <field name="x_duty_cost_mxn" string="3. + Arancel"/>
                            
                            <div class="oe_subtotal_footer_separator oe_inline o_td_label">
                                <label for="x_costo_mayor"/>
                            </div>
                            <field name="x_costo_mayor" nolabel="1" class="oe_subtotal_footer_separator" widget="monetary"/>
                        </group>
                        
                        <group string="Estrategia de Ventas (Configuración)">
                            <label for="x_utilidad" string="Utilidad Base"/>
                            <div class="o_row">
                                <field name="x_utilidad"/>
                                <span class="text-muted">% (Costo / (1 - Utilidad))</span>
                            </div>

                            <label for="x_discount_medium" string="Desc. Nivel Medio"/>
                            <div class="o_row">
                                <field name="x_discount_medium"/>
                                <span class="text-muted">% (Bajada desde Precio Alto)</span>
                            </div>

                            <label for="x_discount_minimum" string="Desc. Nivel Mínimo"/>
                            <div class="o_row">
                                <field name="x_discount_minimum"/>
                                <span class="text-muted">% (Bajada desde Precio Medio)</span>
                            </div>
                            
                            <div class="alert alert-info mt-2" role="alert" colspan="2">
                                <small>
                                    <strong>Nota:</strong> Los precios se recalculan automáticamente al guardar cambios en estos porcentajes.
                                </small>
                            </div>
                        </group>
                    </group>

                    <!-- ESCALERA DE PRECIOS -->
                    <group>
                        <group string="Escalera MXN">
                            <field name="x_price_mxn_1" readonly="1" force_save="1" string="1. Precio 1"/>
                            <field name="x_price_mxn_2" readonly="1" force_save="1" string="2. Precio 2"/>
                            <field name="x_price_mxn_3" readonly="1" force_save="1" string="3. Precio 3" 
                                   groups="inventory_shopping_cart.group_price_authorizer"/>
                        </group>
                        <group string="Escalera USD">
                            <field name="x_price_usd_1" readonly="1" force_save="1" string="1. Precio 1"/>
                            <field name="x_price_usd_2" readonly="1" force_save="1" string="2. Precio 2"/>
                            <field name="x_price_usd_3" readonly="1" force_save="1" string="3. Precio 3" 
                                   groups="inventory_shopping_cart.group_price_authorizer"/>
                        </group>
                    </group>
                </page>
            </xpath>
        </field>
    </record>
</odoo>